{
  "schema_name": "public",
  "tables": [
    {
      "table_name": "document_history",
      "comment": "문서 처리 이력",
      "columns": [
        {
          "column_name": "id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": "uuid_generate_v4()",
          "comment": "이력 고유 ID"
        },
        {
          "column_name": "document_id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": null,
          "comment": "문서 ID"
        },
        {
          "column_name": "action",
          "data_type": "character varying",
          "is_nullable": "NO",
          "default": null,
          "comment": "작업 유형 (crawled, parsed, embedded, summarized, updated)"
        },
        {
          "column_name": "status",
          "data_type": "character varying",
          "is_nullable": "NO",
          "default": null,
          "comment": "작업 상태 (started, completed, failed)"
        },
        {
          "column_name": "details",
          "data_type": "jsonb",
          "is_nullable": "YES",
          "default": "'{}'::jsonb",
          "comment": "작업 상세 정보 (처리 시간, 에러 메시지 등)"
        },
        {
          "column_name": "started_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "NO",
          "default": null,
          "comment": "작업 시작 시간"
        },
        {
          "column_name": "completed_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": null,
          "comment": "작업 완료 시간"
        },
        {
          "column_name": "created_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "생성일"
        }
      ]
    },
    {
      "table_name": "conversations",
      "comment": "대화 세션",
      "columns": [
        {
          "column_name": "id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": "uuid_generate_v4()",
          "comment": "대화 세션 ID"
        },
        {
          "column_name": "user_id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": null,
          "comment": "사용자 ID"
        },
        {
          "column_name": "title",
          "data_type": "character varying",
          "is_nullable": "YES",
          "default": null,
          "comment": "대화 제목 (첫 메시지 기반 자동 생성)"
        },
        {
          "column_name": "session_type",
          "data_type": "character varying",
          "is_nullable": "YES",
          "default": "'general'::character varying",
          "comment": "세션 타입 (general, report_based)"
        },
        {
          "column_name": "primary_document_id",
          "data_type": "uuid",
          "is_nullable": "YES",
          "default": null,
          "comment": "주요 참조 문서 (report_based 시)"
        },
        {
          "column_name": "is_active",
          "data_type": "boolean",
          "is_nullable": "YES",
          "default": "true",
          "comment": "활성 세션 여부"
        },
        {
          "column_name": "created_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "생성일"
        },
        {
          "column_name": "updated_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "최종 수정일"
        }
      ]
    },
    {
      "table_name": "messages",
      "comment": "메시지 내역",
      "columns": [
        {
          "column_name": "id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": "uuid_generate_v4()",
          "comment": "메시지 고유 ID"
        },
        {
          "column_name": "conversation_id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": null,
          "comment": "대화 세션 ID"
        },
        {
          "column_name": "role",
          "data_type": "character varying",
          "is_nullable": "NO",
          "default": null,
          "comment": "메시지 역할 (user, assistant, system)"
        },
        {
          "column_name": "content",
          "data_type": "text",
          "is_nullable": "NO",
          "default": null,
          "comment": "메시지 내용"
        },
        {
          "column_name": "cited_chunks",
          "data_type": "ARRAY",
          "is_nullable": "YES",
          "default": "'{}'::uuid[]",
          "comment": "참조된 청크 ID 리스트"
        },
        {
          "column_name": "follow_up_questions",
          "data_type": "ARRAY",
          "is_nullable": "YES",
          "default": "'{}'::text[]",
          "comment": "후속 질문 제안 리스트 (3개)"
        },
        {
          "column_name": "reference_context",
          "data_type": "jsonb",
          "is_nullable": "YES",
          "default": "'{}'::jsonb",
          "comment": "후속 질문 생성용 컨텍스트 (응답 + 검색 문서)"
        },
        {
          "column_name": "model_version",
          "data_type": "character varying",
          "is_nullable": "YES",
          "default": null,
          "comment": "사용된 LLM 모델 버전 (assistant만)"
        },
        {
          "column_name": "token_usage",
          "data_type": "jsonb",
          "is_nullable": "YES",
          "default": "'{}'::jsonb",
          "comment": "토큰 사용량 {prompt, completion, total}"
        },
        {
          "column_name": "latency_ms",
          "data_type": "integer",
          "is_nullable": "YES",
          "default": null,
          "comment": "응답 지연 시간 (밀리초)"
        },
        {
          "column_name": "created_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "생성일"
        }
      ]
    },
    {
      "table_name": "conversations_history",
      "comment": "Langchain용 대화 히스토리",
      "columns": [
        {
          "column_name": "id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": "uuid_generate_v4()",
          "comment": "히스토리 고유 ID"
        },
        {
          "column_name": "conversation_id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": null,
          "comment": "대화 세션 ID"
        },
        {
          "column_name": "session_id",
          "data_type": "character varying",
          "is_nullable": "NO",
          "default": null,
          "comment": "Langchain 세션 ID"
        },
        {
          "column_name": "history_data",
          "data_type": "jsonb",
          "is_nullable": "NO",
          "default": null,
          "comment": "Langchain 메모리 데이터 (직렬화)"
        },
        {
          "column_name": "created_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "생성일"
        },
        {
          "column_name": "updated_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "최종 수정일"
        }
      ]
    },
    {
      "table_name": "chunks",
      "comment": null,
      "columns": [
        {
          "column_name": "id",
          "data_type": "integer",
          "is_nullable": "NO",
          "default": "nextval('chunks_id_seq'::regclass)",
          "comment": null
        },
        {
          "column_name": "document_id",
          "data_type": "integer",
          "is_nullable": "YES",
          "default": "1",
          "comment": null
        },
        {
          "column_name": "chunk_index",
          "data_type": "integer",
          "is_nullable": "YES",
          "default": null,
          "comment": null
        },
        {
          "column_name": "content",
          "data_type": "text",
          "is_nullable": "YES",
          "default": null,
          "comment": null
        },
        {
          "column_name": "embedding",
          "data_type": "USER-DEFINED",
          "is_nullable": "YES",
          "default": null,
          "comment": null
        }
      ]
    },
    {
      "table_name": "document_summary",
      "comment": "문서 전체 요약 (LLM 생성)",
      "columns": [
        {
          "column_name": "id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": "uuid_generate_v4()",
          "comment": "요약 고유 ID"
        },
        {
          "column_name": "document_id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": null,
          "comment": "문서 ID (1:1 관계)"
        },
        {
          "column_name": "summary_short",
          "data_type": "text",
          "is_nullable": "NO",
          "default": null,
          "comment": "짧은 요약 (200자 이내)"
        },
        {
          "column_name": "summary_long",
          "data_type": "text",
          "is_nullable": "NO",
          "default": null,
          "comment": "긴 요약 (1000자 이내)"
        },
        {
          "column_name": "key_points",
          "data_type": "ARRAY",
          "is_nullable": "YES",
          "default": "'{}'::text[]",
          "comment": "핵심 포인트 리스트"
        },
        {
          "column_name": "entities",
          "data_type": "jsonb",
          "is_nullable": "YES",
          "default": "'{}'::jsonb",
          "comment": "NER 추출 엔티티 (회사명, 인명, 수치 등)"
        },
        {
          "column_name": "model_version",
          "data_type": "character varying",
          "is_nullable": "NO",
          "default": null,
          "comment": "사용된 LLM 모델 버전"
        },
        {
          "column_name": "created_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "생성일"
        },
        {
          "column_name": "updated_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "최종 수정일"
        }
      ]
    },
    {
      "table_name": "users",
      "comment": "사용자 기본 정보 및 OAuth 인증",
      "columns": [
        {
          "column_name": "id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": "uuid_generate_v4()",
          "comment": "사용자 고유 ID"
        },
        {
          "column_name": "oauth_provider",
          "data_type": "character varying",
          "is_nullable": "NO",
          "default": null,
          "comment": "OAuth 제공자 (google, naver, kakao)"
        },
        {
          "column_name": "oauth_id",
          "data_type": "character varying",
          "is_nullable": "NO",
          "default": null,
          "comment": "OAuth 제공자의 사용자 ID"
        },
        {
          "column_name": "email",
          "data_type": "character varying",
          "is_nullable": "NO",
          "default": null,
          "comment": "이메일 주소"
        },
        {
          "column_name": "username",
          "data_type": "character varying",
          "is_nullable": "NO",
          "default": null,
          "comment": "사용자 이름"
        },
        {
          "column_name": "profile_image_url",
          "data_type": "text",
          "is_nullable": "YES",
          "default": null,
          "comment": "프로필 이미지 URL"
        },
        {
          "column_name": "is_active",
          "data_type": "boolean",
          "is_nullable": "YES",
          "default": "true",
          "comment": "계정 활성화 여부"
        },
        {
          "column_name": "created_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "계정 생성일"
        },
        {
          "column_name": "updated_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "최종 수정일"
        },
        {
          "column_name": "last_login_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": null,
          "comment": "마지막 로그인 시간"
        }
      ]
    },
    {
      "table_name": "user_profile",
      "comment": "사용자 프로필 및 학습 수준 정보",
      "columns": [
        {
          "column_name": "id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": "uuid_generate_v4()",
          "comment": "프로필 고유 ID"
        },
        {
          "column_name": "user_id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": null,
          "comment": "사용자 ID (1:1 관계)"
        },
        {
          "column_name": "finance_level",
          "data_type": "character varying",
          "is_nullable": "YES",
          "default": "'beginner'::character varying",
          "comment": "금융 지식 수준 (beginner: 해설 모드, intermediate: 요약 모드, advanced: 심화 모드)"
        },
        {
          "column_name": "interests",
          "data_type": "ARRAY",
          "is_nullable": "YES",
          "default": "'{}'::text[]",
          "comment": "관심 분야 태그 배열 (산업, 섹터 등)"
        },
        {
          "column_name": "created_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "생성일"
        },
        {
          "column_name": "updated_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "최종 수정일"
        }
      ]
    },
    {
      "table_name": "documents",
      "comment": "문서 메타데이터 (PDF, URL 등)",
      "columns": [
        {
          "column_name": "id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": "uuid_generate_v4()",
          "comment": "문서 고유 ID"
        },
        {
          "column_name": "source_type",
          "data_type": "character varying",
          "is_nullable": "NO",
          "default": null,
          "comment": "문서 소스 타입 (pdf, url, text)"
        },
        {
          "column_name": "source_url",
          "data_type": "text",
          "is_nullable": "NO",
          "default": null,
          "comment": "원본 URL (크롤링 소스)"
        },
        {
          "column_name": "source_nid",
          "data_type": "text",
          "is_nullable": "NO",
          "default": null,
          "comment": "원본 URL 게시물 ID"
        },
        {
          "column_name": "file_url",
          "data_type": "text",
          "is_nullable": "YES",
          "default": null,
          "comment": "파일 URL"
        },
        {
          "column_name": "file_id",
          "data_type": "text",
          "is_nullable": "YES",
          "default": null,
          "comment": "파일 URL 상 ID"
        },
        {
          "column_name": "title",
          "data_type": "character varying",
          "is_nullable": "NO",
          "default": null,
          "comment": "문서 제목"
        },
        {
          "column_name": "author",
          "data_type": "character varying",
          "is_nullable": "YES",
          "default": null,
          "comment": "저자 또는 기관명"
        },
        {
          "column_name": "published_date",
          "data_type": "date",
          "is_nullable": "YES",
          "default": null,
          "comment": "발행일"
        },
        {
          "column_name": "file_path",
          "data_type": "text",
          "is_nullable": "YES",
          "default": null,
          "comment": "저장된 파일 경로 (S3, 로컬 등)"
        },
        {
          "column_name": "file_size",
          "data_type": "bigint",
          "is_nullable": "YES",
          "default": null,
          "comment": "파일 크기 (bytes)"
        },
        {
          "column_name": "total_pages",
          "data_type": "integer",
          "is_nullable": "YES",
          "default": null,
          "comment": "총 페이지 수 (PDF)"
        },
        {
          "column_name": "language",
          "data_type": "character varying",
          "is_nullable": "YES",
          "default": "'ko'::character varying",
          "comment": "문서 언어 (ko, en 등)"
        },
        {
          "column_name": "metadata",
          "data_type": "jsonb",
          "is_nullable": "YES",
          "default": "'{}'::jsonb",
          "comment": "추가 메타데이터 (자유 형식 JSONB)"
        },
        {
          "column_name": "processing_status",
          "data_type": "character varying",
          "is_nullable": "YES",
          "default": "'pending'::character varying",
          "comment": "처리 상태 (pending, processing, completed, failed)"
        },
        {
          "column_name": "created_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "생성일"
        },
        {
          "column_name": "updated_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "최종 수정일"
        }
      ]
    },
    {
      "table_name": "document_layout",
      "comment": "PDF 레이아웃 분석 결과 (페이지별)",
      "columns": [
        {
          "column_name": "id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": "uuid_generate_v4()",
          "comment": "레이아웃 고유 ID"
        },
        {
          "column_name": "document_id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": null,
          "comment": "문서 ID"
        },
        {
          "column_name": "page_number",
          "data_type": "integer",
          "is_nullable": "NO",
          "default": null,
          "comment": "페이지 번호"
        },
        {
          "column_name": "element_type",
          "data_type": "character varying",
          "is_nullable": "NO",
          "default": null,
          "comment": "요소 타입 (text, image, table, chart, header, footer, caption)"
        },
        {
          "column_name": "element_order",
          "data_type": "integer",
          "is_nullable": "NO",
          "default": null,
          "comment": "페이지 내 요소 순서"
        },
        {
          "column_name": "bbox",
          "data_type": "jsonb",
          "is_nullable": "NO",
          "default": null,
          "comment": "Bounding Box 좌표 {x1, y1, x2, y2}"
        },
        {
          "column_name": "content",
          "data_type": "text",
          "is_nullable": "YES",
          "default": null,
          "comment": "텍스트 내용 (text 타입인 경우)"
        },
        {
          "column_name": "asset_id",
          "data_type": "uuid",
          "is_nullable": "YES",
          "default": null,
          "comment": "관련 에셋 ID (image, table 등)"
        },
        {
          "column_name": "metadata",
          "data_type": "jsonb",
          "is_nullable": "YES",
          "default": "'{}'::jsonb",
          "comment": "추가 메타데이터 (폰트, 색상 등)"
        },
        {
          "column_name": "created_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "생성일"
        }
      ]
    },
    {
      "table_name": "document_asset",
      "comment": "문서 내 이미지, 표 등 에셋",
      "columns": [
        {
          "column_name": "id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": "uuid_generate_v4()",
          "comment": "에셋 고유 ID"
        },
        {
          "column_name": "document_id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": null,
          "comment": "문서 ID"
        },
        {
          "column_name": "asset_type",
          "data_type": "character varying",
          "is_nullable": "NO",
          "default": null,
          "comment": "에셋 타입 (image, table, chart)"
        },
        {
          "column_name": "page_number",
          "data_type": "integer",
          "is_nullable": "NO",
          "default": null,
          "comment": "페이지 번호"
        },
        {
          "column_name": "file_path",
          "data_type": "text",
          "is_nullable": "YES",
          "default": null,
          "comment": "저장된 파일 경로 (로컬 또는 S3)"
        },
        {
          "column_name": "raw_data",
          "data_type": "text",
          "is_nullable": "YES",
          "default": null,
          "comment": "원본 데이터 (표 HTML, CSV 등)"
        },
        {
          "column_name": "description",
          "data_type": "text",
          "is_nullable": "YES",
          "default": null,
          "comment": "LLM 생성 설명 (이미지 캡션 등)"
        },
        {
          "column_name": "extracted_text",
          "data_type": "text",
          "is_nullable": "YES",
          "default": null,
          "comment": "OCR 추출 텍스트 (이미지 내 텍스트)"
        },
        {
          "column_name": "metadata",
          "data_type": "jsonb",
          "is_nullable": "YES",
          "default": "'{}'::jsonb",
          "comment": "추가 메타데이터"
        },
        {
          "column_name": "created_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "생성일"
        }
      ]
    },
    {
      "table_name": "document_chunks",
      "comment": "벡터 임베딩을 위한 청크 데이터",
      "columns": [
        {
          "column_name": "id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": "uuid_generate_v4()",
          "comment": "청크 고유 ID"
        },
        {
          "column_name": "document_id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": null,
          "comment": "문서 ID"
        },
        {
          "column_name": "chunk_index",
          "data_type": "integer",
          "is_nullable": "NO",
          "default": null,
          "comment": "청크 순서"
        },
        {
          "column_name": "content",
          "data_type": "text",
          "is_nullable": "NO",
          "default": null,
          "comment": "청크 텍스트 내용"
        },
        {
          "column_name": "content_type",
          "data_type": "character varying",
          "is_nullable": "YES",
          "default": "'text'::character varying",
          "comment": "콘텐츠 타입 (text, table_summary, image_caption)"
        },
        {
          "column_name": "page_numbers",
          "data_type": "ARRAY",
          "is_nullable": "NO",
          "default": null,
          "comment": "관련 페이지 번호들 배열"
        },
        {
          "column_name": "embedding",
          "data_type": "USER-DEFINED",
          "is_nullable": "NO",
          "default": null,
          "comment": "OpenAI 임베딩 벡터 (1536차원)"
        },
        {
          "column_name": "keywords",
          "data_type": "ARRAY",
          "is_nullable": "YES",
          "default": "'{}'::text[]",
          "comment": "추출된 핵심 키워드 리스트 (키워드 검색용)"
        },
        {
          "column_name": "full_text_search",
          "data_type": "tsvector",
          "is_nullable": "YES",
          "default": null,
          "comment": "PostgreSQL Full-Text Search 벡터 (자동 생성)"
        },
        {
          "column_name": "metadata",
          "data_type": "jsonb",
          "is_nullable": "YES",
          "default": "'{}'::jsonb",
          "comment": "추가 메타데이터 (NER 엔티티 등)"
        },
        {
          "column_name": "token_count",
          "data_type": "integer",
          "is_nullable": "NO",
          "default": null,
          "comment": "토큰 수"
        },
        {
          "column_name": "created_at",
          "data_type": "timestamp without time zone",
          "is_nullable": "YES",
          "default": "CURRENT_TIMESTAMP",
          "comment": "생성일"
        }
      ]
    }
  ]
}
